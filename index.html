<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AttendanceMaster | Gesti√≥n de Asistencia Profesional</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AttendanceMaster">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Attendance<span>Master</span></h2>
            </div>
            <nav class="side-nav">
                <button class="nav-item active" data-tab="register-tab">
                    <span class="icon">üìÖ</span> Registro Diario
                </button>
                <button class="nav-item" data-tab="evolution-tab">
                    <span class="icon">üìà</span> Evoluci√≥n Anual
                </button>
                <button class="nav-item" id="btn-open-names-modal">
                    <span class="icon">üë•</span> Gesti√≥n de Nombres
                </button>
                <button class="nav-item" id="btn-open-config-modal">
                    <span class="icon">‚öôÔ∏è</span> Copia y Portabilidad
                </button>
            </nav>
            <div class="sidebar-info">
                <p>Almacenamiento Local Activo</p>
                <small id="db-status">Preparado</small>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Tabs Content -->

            <!-- Tab 1: Registro Diario -->
            <section id="register-tab" class="tab-content active">
                <div class="hero-banner">
                    <img src="hybrid_attendance_panoramic_hero_1770032181676.png" alt="AttendanceMaster Hero">
                </div>
                <header class="section-header">
                    <div class="date-selector">
                        <label for="meeting-date">Fecha de la Reuni√≥n:</label>
                        <input type="date" id="meeting-date">
                    </div>
                    <div class="summary-cards">
                        <div class="sum-card">
                            <span class="label">Presencial</span>
                            <span class="value" id="val-presencial">0</span>
                        </div>
                        <div class="sum-card">
                            <span class="label">Zoom</span>
                            <span class="value" id="val-zoom">0</span>
                        </div>
                        <div class="sum-card total">
                            <span class="label">Total</span>
                            <span class="value" id="val-total">0</span>
                        </div>
                    </div>
                </header>

                <div class="entry-grid">
                    <!-- Presencial Column -->
                    <div class="entry-column card">
                        <h3>Asistencia Presencial</h3>
                        <div class="form-group">
                            <label>Hermanos/Hermanas/Peques (Total Presencial)</label>
                            <input type="number" id="input-presencial" min="0" value="0" placeholder="Ej: 45"
                                autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                        </div>
                        <p class="hint">Anote aqu√≠ la suma total de personas presentes en la sala.</p>
                    </div>

                    <!-- Zoom Column -->
                    <div class="entry-column card wide">
                        <div class="card-header">
                            <h3>Asistencia por Zoom</h3>
                            <button id="btn-add-zoom" class="btn small">+ A√±adir Conexi√≥n</button>
                        </div>
                        <div class="zoom-table-container">
                            <table id="zoom-table">
                                <thead>
                                    <tr>
                                        <th>Nombre (Asistente)</th>
                                        <th width="100">Cnx.</th>
                                        <th width="50">Acci√≥n</th>
                                    </tr>
                                </thead>
                                <tbody id="zoom-body">
                                    <!-- Filas din√°micas aqu√≠ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="save-actions" style="gap: 1rem;">
                    <button id="btn-save-all" class="btn primary">Guardar Registro del D√≠a</button>
                    <button id="btn-open-report" class="btn secondary">üìÑ Generar Reporte</button>
                </div>
            </section>

            <!-- Tab 2: Evoluci√≥n Anual -->
            <section id="evolution-tab" class="tab-content">
                <header class="section-header">
                    <h1>Evoluci√≥n Anual Asistencia</h1>
                    <div class="year-selector">
                        <select id="select-year"></select>
                    </div>
                </header>

                <div class="charts-container">
                    <div class="chart-card">
                        <h3>Tendencia de Asistencia</h3>
                        <div class="canvas-wrapper">
                            <canvas id="annual-evolution-chart"></canvas>
                        </div>
                    </div>
                    <div class="stats-footer">
                        <div class="footer-stat">
                            <span class="label">M√°ximo Asistentes</span>
                            <span class="value" id="stat-max">0</span>
                        </div>
                        <div class="footer-stat">
                            <span class="label">Promedio Mensual</span>
                            <span class="value" id="stat-avg">0</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals or Datalist for suggestions -->
    <datalist id="suggested-names">
        <!-- Se llenar√° din√°micamente -->
    </datalist>

    <!-- Modal: Gesti√≥n de Nombres -->
    <div id="modal-names" class="modal">
        <div class="modal-content wide">
            <h3>Gesti√≥n Maestra de Nombres</h3>
            <p class="hint">Pegue aqu√≠ la lista de nombres (uno por l√≠nea) para que aparezcan como sugerencias.</p>
            <div class="form-group">
                <textarea id="import-names-area" placeholder="Ej:&#10;Juan Perez&#10;Maria Garcia&#10;Pedro Lopez"
                    rows="10"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn secondary close-modal">Cerrar</button>
                <button type="button" id="btn-save-names" class="btn primary">Guardar Nombres</button>
            </div>
        </div>
    </div>

    <!-- Modal: Reporte Profesional -->
    <div id="modal-report" class="modal">
        <div class="modal-content wide report-view-modal">
            <h3>Vista Previa del Reporte</h3>
            <div id="report-preview" class="report-container">
                <!-- Se generar√° din√°micamente -->
            </div>
            <div class="form-actions">
                <button type="button" class="btn secondary close-modal">Cerrar</button>
                <button type="button" id="btn-copy-whatsapp" class="btn btn-whatsapp">üì± Copiar para WhatsApp</button>
                <button type="button" id="btn-print-pdf" class="btn primary">üñ®Ô∏è Imprimir PDF</button>
            </div>
        </div>
    </div>

    <!-- Modal: Configuraci√≥n y Portabilidad -->
    <div id="modal-config" class="modal">
        <div class="modal-content">
            <h3>Copia de Seguridad y Portabilidad</h3>
            <p class="hint">Usa estas opciones para mover tu aplicaci√≥n a otra carpeta o hacer una copia de tus
                registros.</p>

            <div class="config-actions">
                <button id="btn-export-json" class="btn secondary">
                    <span>üì•</span> Exportar Datos (JSON)
                </button>
                <div class="import-zone">
                    <p class="hint">Para restaurar o mover datos:</p>
                    <input type="file" id="import-file" accept=".json" style="display: none;">
                    <button id="btn-import-trigger" class="btn primary">
                        <span>üì§</span> Importar Datos (Seleccionar Archivo)
                    </button>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn secondary close-modal">Cerrar</button>
            </div>
        </div>
    </div>

    <script src="db.js"></script>
    <script src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js');
        }
    </script>
</body>

</html>